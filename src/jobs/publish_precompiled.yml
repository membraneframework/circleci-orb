description: >
  Publish a precompiled package

parameters:
  version:
    description: "Version of the github release"
    type: "string"
    default: "latest"

docker:
  - image: ubuntu
steps:
  - attach_workspace:
      at: ~/
  - run: 
      name: Prepare artifacts
      command: |
        mkdir /root/artifacts
        directory=/root/workspace
        for subdir in "$directory"/*; do
          if [ -d "$subdir" ]; then  
            subdir_name="$(basename "$subdir")"
            tar -czvf "$subdir_name.tar.gz" -C "$directory" "$subdir_name"
            mv "$subdir_name.tar.gz" /root/artifacts
          fi
        done
  - run: 
      name: Publish release
      command: include(scripts/publish_release.sh)
      environment:
        VERSION: << parameters.version >>
        